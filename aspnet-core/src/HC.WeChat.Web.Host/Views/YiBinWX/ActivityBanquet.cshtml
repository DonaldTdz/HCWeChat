
@{
    ViewData["Title"] = "宴席信息完善";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>宴席信息完善</title>
    <link rel="stylesheet" href="static/css/base.css" />
    <link rel="stylesheet" href="static/css/commons.css" />
    <link rel="stylesheet" href="static/css/tobacco.css" />
</head>
<body class="bg_gary">
    <!--页面整体-->
    <div class="all_width">
        <!--通用头部-->
        <div class="header bg_green tc">
            宴席信息完善
        </div>
        <!--banner展示-->
        <img src="static/img/activity/banner.jpg" class="img_width" />
        <!--活动申请输入部分-->
        <div class="pr advise_area">
            <!--透明背景-->
            <div class="opacity_bg all_width">
                <!--选其它需要输入商品规格-->
                <div class="advise_warp pt5 pb5">
                    <span class="entry_key fl">区    县</span>
                    <input type="text" maxlength="500" id="txtArea" class="fl ml10 entry_value" placeholder="请输入区县" />
                </div>
                <!--申请数量-->
                <div class="advise_warp pt5 pb5">
                    <span class="entry_key fl">宴席时间</span>
                    <input type="date" id="txtBanquetTime" maxlength="20" class="fl ml10 entry_value" placeholder="请输入宴席时间" />
                </div>
                <div class="advise_warp pt5 pb5">
                    <span class="entry_key fl">宴席地点</span>
                    <input type="text" id="txtPosition" class="fl ml10 entry_value" placeholder="请输入宴席地点" />
                </div>
                <div class="advise_warp pt5 pb5">
                    <span class="entry_key fl">现场人数</span>
                    <input type="number" id="txtNum" class="fl ml10 entry_value" placeholder="请输入现场人数" />
                </div>
                <div class="advise_warp">
                    <span class="entry_key db pb3 pt3">现场简述</span>
                    <!--内容输入框-->
                    <textarea class="contain_entry" id="txtDesc" maxlength="500" placeholder="请输入现场简述"></textarea>
                </div>
                <div class="advise_warp pt5 pb5">
                    <span class="entry_key fl">推荐人姓名</span>
                    <input type="text" maxlength="50" id="txtUserNaem" class="fl ml10 entry_value" placeholder="请输入收货姓名" />
                </div>
                <!--联系电话-->
                <div class="advise_warp pt3 pb3">
                    <span class="entry_key fl">推荐人电话</span>
                    <input type="number" maxlength="11" id="txtPhone" class="fl ml10 entry_value" placeholder="请输入联系电话" />
                </div>
                <!--收货地址-->
                <div class="advise_warp pt3 pb3">
                    <span class="entry_key fl">推荐人地址</span>
                    <textarea class="contain_entry" id="txtAddress" placeholder="请输入收货地址"></textarea>
                </div>
                <!--备注-->
                <div class="advise_warp pt3 pb3">
                    <span class="entry_key fl">备注</span>
                    <textarea class="contain_entry" id="txtDeliveryRemark" placeholder="请输入备注"></textarea>
                </div>
                <input type="hidden" id="hidOpenId" value="@ViewBag.OpenId" />
                <input type="hidden" id="hidTenantId" value="@ViewBag.TenantId" />
                <input type="hidden" id="hidActivityFormId" value="@ViewBag.ActivityFormId" />
            </div>
        </div>
        <!--用户操作按钮-->
        <div class="width_90 mt30 mb20">
            <input type="button" class="middel_btn fl cancel" onclick="Cancel()" value="取消" />
            <input type="button" class="middel_btn fr ok" id="btnSave" value="提交资料" onclick="Save()" />
        </div>
    </div>
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript">
        function checkMobile(str) {
            var re = /^1\d{10}$/
            return re.test(str);
        }

        var Cancel = function () {
            WeixinJSBridge.call('closeWindow');
        }

        var Save = function () {
            var reqUrl = "@ViewBag.ServerRootAddress" + "/api/services/app/ActivityBanquet/SubmitActivityBanquetWeChatAsync";
            var para = {};
            para.area = $("#txtArea").val();
            if (para.area == "") {
                alert("区县不能为空！");
                return;
            }

            para.banquetTime = $("#txtBanquetTime").val();
            if (para.banquetTime == "") {
                alert("宴席时间不能为空！");
                return;
            }
            para.position = $("#txtPosition").val();
            if (para.reason == "") {
                alert("宴席地点不能为空！");
                return;
            }

            para.num = $("#txtNum").val();
            if (para.num == "") {
                alert("现场人数不能为空！");
                return;
            }

            para.desc = $("#txtDesc").val();
            if (para.desc == "") {
                alert("现场简述不能为空！");
                return;
            }

            para.userName = $("#txtUserNaem").val();
            if (para.userName == "") {
                alert("推荐人姓名不能为空！");
                return;
            }
            para.phone = $("#txtPhone").val();
            if (para.phone == "") {
                alert("推荐人电话不能为空！");
                return;
            }

            if (!checkMobile(para.phone)) {
                alert("请输入正确的推荐人电话！");
                return;
            }

            para.address = $("#txtAddress").val();
            if (para.address == "") {
                alert("推荐地址不能为空！");
                return;
            }

            para.photoUrl = "test.jpg";

            para.deliveryRemark = $("#txtDeliveryRemark").val();

            para.tenantId = $("#hidTenantId").val();
            para.openId = $("#hidOpenId").val();
            para.activityFormId = $("#hidActivityFormId").val();
            if (confirm("请确认信息填写无误，提交后不可更改")) {
                $("#btnSave").attr("disabled", true);
                $("#btnSave").attr("disabled", "disabled");
                $.ajax({
                    url: reqUrl,
                    type: "POST",
                    dataType: "JSON",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(para),
                    success: function (data) {
                        if (data.success) {
                            if (data.result.code == 0) {
                                alert(data.result.msg);
                                WeixinJSBridge.call('closeWindow');
                            } else {
                                alert(data.result.msg);
                            }
                        } else {
                            alert("保存异常！");
                        }
                        $("#btnSave").removeAttr("disabled");
                        $("#btnSave").attr("disabled", false);
                    },
                    error: function () {
                        alert("提交失败！");
                        $("#btnSave").removeAttr("disabled");
                        $("#btnSave").attr("disabled", false);
                    }
                });
            }
        }
    </script>
</body>
</html>


